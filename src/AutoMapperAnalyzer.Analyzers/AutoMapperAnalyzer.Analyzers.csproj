<Project Sdk="Microsoft.NET.Sdk">
  <PropertyGroup>
    <TargetFramework>netstandard2.0</TargetFramework>
    <ImplicitUsings>enable</ImplicitUsings>
    <Nullable>enable</Nullable>
    <LangVersion>latest</LangVersion>
    <GenerateDocumentationFile>true</GenerateDocumentationFile>
    <EnforceExtendedAnalyzerRules>true</EnforceExtendedAnalyzerRules>
    <!-- Analyzer Package Configuration -->
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <GeneratePackageOnBuild>false</GeneratePackageOnBuild>
    <DevelopmentDependency>true</DevelopmentDependency>
    <PrivateAssets>all</PrivateAssets>
    <!-- NuGet Package Metadata -->
    <PackageId>AutoMapperAnalyzer.Analyzers</PackageId>
    <!-- Semantic Versioning: Version is set by release workflow via /p:PackageVersion=X.Y.Z -->
    <!-- Fallback for local builds: 2.0.YYYYMMDD-local -->
    <MajorVersion>2</MajorVersion>
    <MinorVersion>2</MinorVersion>
    <BuildNumber Condition="'$(BuildNumber)' == ''"
      >$([System.DateTime]::Now.ToString('yyyyMMdd'))</BuildNumber
    >
    <PackageVersion Condition="'$(PackageVersion)' == ''">$(MajorVersion).$(MinorVersion).$(BuildNumber)-local</PackageVersion>
    <Title>AutoMapper Roslyn Analyzer</Title>
    <Authors>George Wall</Authors>
    <Description>Catch AutoMapper configuration errors at compile-time before they cause runtime chaos! This Roslyn analyzer detects type mismatches, nullable issues, missing properties, collection incompatibilities, and complex mapping problems - all with intelligent code fixes. Transform AutoMapper development from reactive debugging to proactive prevention. Features 10 analyzer rules with smart fixes for type safety, data integrity, and complex mappings. Compatible with .NET Framework 4.8+, .NET 6.0+, 8.0+, and 9.0+.</Description>
    <PackageTags>roslyn;analyzer;automapper;mapping;static-analysis;codeanalysis;code-quality;diagnostics;code-fix;type-safety;compile-time;netframework;netcore;dotnet;dotnet6;dotnet8;dotnet9</PackageTags>
    <PackageLicenseExpression>MIT</PackageLicenseExpression>
    <PackageProjectUrl>https://github.com/georgepwall1991/automapper-analyser</PackageProjectUrl>
    <RepositoryUrl>https://github.com/georgepwall1991/automapper-analyser</RepositoryUrl>
    <RepositoryType>git</RepositoryType>
    <PackageRequireLicenseAcceptance>false</PackageRequireLicenseAcceptance>
    <PackageReleaseNotes>Version 2.2.0 - AM031 Performance Warning Analyzer

⚡ New Analyzers - AM031 Performance Warnings:
• AM031.001: Detects expensive operations (database queries, file I/O, HTTP requests, reflection)
• AM031.002: Multiple collection enumerations warning with caching suggestions
• AM031.003: Task.Result synchronous access (deadlock risk detection)
• AM031.004: Non-deterministic operations (DateTime.Now, Random, Guid.NewGuid)
• AM031.005: Complex LINQ operations (SelectMany with nested Where/Select)
• AM031.006: Expensive computational patterns in mappings

✨ Key Features:
• Intelligent code fixes that suggest moving expensive operations before mapping
• Collection enumeration caching recommendations
• DateTime.Now detection via property access analysis
• Enhanced lambda expression analysis for both invocations and property accesses

📊 Test Coverage:
• 397 passing tests (99% pass rate)
• 30 new AM031 tests (28 passing, 2 skipped due to test framework limitations)
• Comprehensive samples demonstrating all detected scenarios

🛠️ Technical Improvements:
• Added MemberAccessExpression analysis for property-based operations
• Enhanced IsComplexLinqOperation to detect SelectMany patterns
• Improved semantic model traversal for nested lambda expressions

Previous Release (2.1.0):
• Enhanced AM020 with internal property and cross-profile detection
• 374 passing tests

🔗 Full Release Notes: https://github.com/georgepwall1991/automapper-analyser/releases</PackageReleaseNotes>
    <PackageReadmeFile>README.md</PackageReadmeFile>
    <PackageIcon>icon.png</PackageIcon>
    <!-- Remove strict PackageType for broader compatibility -->
    <NoPackageAnalysis>true</NoPackageAnalysis>
  </PropertyGroup>
  <ItemGroup>
    <PackageReference
      Include="Microsoft.CodeAnalysis.Analyzers"
      Version="4.14.0"
      PrivateAssets="all"
    />
    <PackageReference
      Include="Microsoft.CodeAnalysis.CSharp"
      Version="4.14.0"
      PrivateAssets="all"
    />
    <PackageReference
      Include="Microsoft.CodeAnalysis.CSharp.Workspaces"
      Version="4.14.0"
      PrivateAssets="all"
    />
    <PackageReference
      Include="Microsoft.CodeAnalysis.Workspaces.Common"
      Version="4.14.0"
      PrivateAssets="all"
    />
  </ItemGroup>
  <ItemGroup>
    <None Include="..\..\README.md" Pack="true" PackagePath="\" />
    <None Include="..\..\icon.png" Pack="true" PackagePath="\" />
  </ItemGroup>
  <!-- Analyzer files for NuGet package -->
  <ItemGroup>
    <None
      Include="bin\$(Configuration)\$(TargetFramework)\$(AssemblyName).dll"
      Pack="true"
      PackagePath="analyzers\dotnet\cs\$(AssemblyName).dll"
      Visible="false"
    />
    <None
      Include="bin\$(Configuration)\$(TargetFramework)\$(AssemblyName).dll"
      Pack="true"
      PackagePath="analyzers\dotnet\$(AssemblyName).dll"
      Visible="false"
    />
  </ItemGroup>
</Project>
